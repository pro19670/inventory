<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì¦ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { margin: 10px; padding: 10px 20px; font-size: 16px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ” ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
    
    <div>
        <button onclick="testLogin()">ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ì ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testLogin('ì—„ë§ˆ', 'mom123')">ğŸ‘© ì—„ë§ˆ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸</button>
        <button onclick="checkAuthState()">ğŸ” í˜„ì¬ ìƒíƒœ í™•ì¸</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        const API_URL = 'https://3001-i72krmbsmpnff1c7v14w6-6532622b.e2b.dev/api';
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        async function testLogin(username = 'ê´€ë¦¬ì', password = 'admin123') {
            try {
                addResult(`ğŸ”„ ${username} ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„ ì¤‘...`, 'info');
                
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('familyAuthToken', data.token);
                    localStorage.setItem('currentUser', JSON.stringify(data.user));
                    
                    addResult(`âœ… ë¡œê·¸ì¸ ì„±ê³µ! ì‚¬ìš©ì: ${data.user.username} (${data.user.role})`, 'success');
                    addResult(`ğŸ« í† í°: ${data.token.substring(0, 30)}...`, 'info');
                    
                    // ë©”ì¸ í˜ì´ì§€ë¡œ ìƒíƒœ ì „íŒŒ
                    if (window.opener) {
                        window.opener.postMessage({
                            type: 'LOGIN_SUCCESS',
                            token: data.token,
                            user: data.user
                        }, '*');
                    }
                } else {
                    addResult(`âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${data.error}`, 'error');
                }
            } catch (error) {
                addResult(`ğŸ’¥ ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        function testLogout() {
            const token = localStorage.getItem('familyAuthToken');
            if (!token) {
                addResult('âš ï¸ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤', 'error');
                return;
            }
            
            localStorage.removeItem('familyAuthToken');
            localStorage.removeItem('currentUser');
            
            addResult('ğŸšª ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ - í† í° ë° ì‚¬ìš©ì ì •ë³´ ì œê±°ë¨', 'success');
            
            // ë©”ì¸ í˜ì´ì§€ë¡œ ìƒíƒœ ì „íŒŒ
            if (window.opener) {
                window.opener.postMessage({
                    type: 'LOGOUT_SUCCESS'
                }, '*');
            }
        }
        
        function checkAuthState() {
            const token = localStorage.getItem('familyAuthToken');
            const user = localStorage.getItem('currentUser');
            
            if (token) {
                const userInfo = user ? JSON.parse(user) : null;
                addResult(`ğŸ” ë¡œê·¸ì¸ ìƒíƒœ: ${userInfo?.username || 'ì•Œ ìˆ˜ ì—†ìŒ'} (${userInfo?.role || 'ì—­í•  ë¯¸ìƒ'})`, 'success');
                addResult(`ğŸ« í† í°: ${token.substring(0, 30)}...`, 'info');
            } else {
                addResult('ğŸ”“ ë¡œê·¸ì•„ì›ƒ ìƒíƒœ - í† í° ì—†ìŒ', 'info');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
        window.onload = () => {
            checkAuthState();
        };
    </script>
</body>
</html>